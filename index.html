<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Realty Companion Pro – Chicago Edition</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0B162A"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline'; script-src 'self'; frame-src https:; connect-src 'self' https:;">
  <link rel="icon" href="icons/icon-192.png"/>
  <style>
    body,html{margin:0;height:100%;background:#0B162A;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
    header{padding:12px 16px;background:linear-gradient(90deg,#0B162A,#8C1C13);display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(255,255,255,.1)}
    .badge{font-size:12px;opacity:.8}
    #appframe{width:100%;height:calc(100vh - 54px);border:0;background:#111}
    .bar{display:flex;justify-content:space-between;align-items:center;width:100%}
    button{background:#E50914;color:#fff;border:0;border-radius:10px;padding:8px 12px;font-weight:600}
    .spin{display:none;margin-left:8px}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div><strong>Realty Companion Pro</strong> <span class="badge">Chicago Edition • v4.2.5</span></div>
      <div>
        <button id="installBtn" style="display:none">Install</button>
        <span id="spin" class="spin">Optimizing…</span>
      </div>
    </div>
  </header>
  <iframe id="appframe" src="about:blank" title="Realty Companion App"></iframe>
  <script>
    let deferredPrompt; const installBtn=document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault(); deferredPrompt=e; installBtn.style.display='inline-block';});
    installBtn.addEventListener('click', async()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; });
    const params=new URLSearchParams(location.search); const iframe=document.getElementById('appframe'); const spin=document.getElementById('spin');
    const override=params.get('url');
    async function resolve(){ try{
      spin.style.display='inline-block';
      if(override){ iframe.src=override; spin.style.display='none'; return; }
      const r=await fetch('version.json'); const j=await r.json(); iframe.src=j.streamlit_url || 'about:blank';
    }catch(e){ iframe.src='about:blank'; }finally{ spin.style.display='none'; } }
    resolve();
    if('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
